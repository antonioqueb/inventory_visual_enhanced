<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    
    <t t-name="inventory_visual_enhanced.InventoryView" owl="1">
        <div class="o_inventory_visual_container d-flex flex-column vh-100" t-ref="root">
            
            <!-- Barra de búsqueda superior -->
            <div class="o_inventory_visual_searchbar flex-shrink-0 sticky-top">
                <div class="searchbar-inner container d-flex align-items-center justify-content-between gap-2">
                    
                    <div class="searchbar-input-wrapper mx-auto col-12 col-md-8 col-lg-6 px-0 position-relative">
                        <i class="fa fa-search search-icon"></i>
                        <input 
                            type="text"
                            class="form-control"
                            placeholder="Buscar por producto, código o familia (ej: Tajmahal)..."
                            t-model="state.searchTerm"
                            t-on-input="onSearchInput"
                            t-att-disabled="state.isLoading"
                        />
                        <button 
                            class="clear-search btn btn-link p-0"
                            t-att-class="{ visible: state.searchTerm.length > 0 }"
                            t-on-click="clearSearch"
                        >
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="searchbar-info text-nowrap ms-auto" t-if="state.hasSearched">
                        <span class="count" t-esc="state.totalProducts"></span>
                        <span t-if="state.totalProducts === 1"> producto</span>
                        <span t-else=""> productos</span>
                    </div>
                </div>
            </div>
            
            <!-- Contenido principal -->
            <div class="o_inventory_visual_content flex-grow-1 overflow-auto">
                
                <!-- Estado inicial -->
                <div class="o_inventory_visual_empty" t-if="!state.hasSearched and !state.isLoading">
                    <i class="fa fa-search empty-icon"></i>
                    <h2 class="empty-title">Busca para visualizar tu inventario</h2>
                    <p class="empty-subtitle">
                        Escribe el nombre de un producto, código o familia en el buscador superior
                        para ver el inventario agrupado con métricas detalladas.
                    </p>
                </div>
                
                <!-- Loading -->
                <div class="o_inventory_loading" t-if="state.isLoading">
                    <div class="spinner"></div>
                    <div class="loading-text">Cargando inventario...</div>
                </div>
                
                <!-- Error -->
                <div class="o_inventory_error" t-if="state.error">
                    <i class="fa fa-exclamation-triangle error-icon"></i>
                    <div class="error-message" t-esc="state.error"></div>
                </div>
                
                <!-- Sin resultados -->
                <div class="o_inventory_no_results" t-if="state.hasSearched and state.products.length === 0 and !state.isLoading">
                    <i class="fa fa-inbox no-results-icon"></i>
                    <h3 class="no-results-title">No se encontraron productos</h3>
                    <p class="no-results-message">
                        Intenta con otro término de búsqueda o verifica el inventario disponible.
                    </p>
                </div>
                
                <!-- DATA GRID -->
                <div class="o_inventory_data_grid" t-if="state.products.length > 0 and !state.isLoading">
                    <table class="o_inventory_grid_table">
                        <thead>
                            <tr>
                                <th class="col-product-name">Product Name (SKU)</th>
                                <th class="col-inventory">Inventory</th>
                                <th class="col-type">Type</th>
                                <th class="col-category">Category</th>
                                <th class="col-format">Format</th>
                                <th class="col-actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="state.products" t-as="product" t-key="product.product_id">
                                <ProductRow 
                                    product="product"
                                    isExpanded="isProductExpanded(product.product_id)"
                                    details="getProductDetails(product.product_id)"
                                    onToggle.bind="(quantIds) => this.toggleProduct(product.product_id, quantIds)"
                                    onPhotoClick.bind="onPhotoClick"
                                    onNotesClick.bind="onNotesClick"
                                    onDetailsClick.bind="onDetailsClick"
                                    onSalesPersonClick.bind="onSalesPersonClick"
                                    onHoldClick.bind="onHoldClick"
                                    onSaleOrderClick.bind="onSaleOrderClick"
                                    formatNumber.bind="formatNumber"
                                />
                            </t>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </t>
    
</templates>