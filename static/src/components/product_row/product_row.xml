<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    
    <t t-name="inventory_visual_enhanced.ProductRow" owl="1">
        <tr class="o_inventory_product_row" t-att-class="{ expanded: props.isExpanded }">
            
            <!-- CHECKBOX: SELECCIONAR TODO EL PRODUCTO -->
            <td class="col-checkbox-all">
                <div class="checkbox-wrapper" t-on-click.stop="">
                    <input 
                        type="checkbox"
                        class="form-check-input select-all-checkbox"
                        title="Seleccionar todos los lotes de este producto"
                        t-att-checked="props.areAllCurrentProductSelected()"
                        t-on-change="(ev) => ev.target.checked ? props.selectAllCurrentProduct() : props.deselectAllCurrentProduct()"
                    />
                </div>
            </td>

            <!-- Product Name -->
            <td class="col-product-name" t-on-click="() => props.onToggle(props.product.quant_ids)">
                <div class="product-name-cell">
                    <div class="product-title" t-esc="props.product.product_name"></div>
                    <div class="product-sku" t-if="props.product.product_code">
                        <i class="fa fa-tag me-1"></i>
                        <t t-esc="props.product.product_code"/>
                    </div>
                </div>
            </td>
            
            <!-- Inventory Summary -->
            <td class="col-inventory" t-on-click="() => props.onToggle(props.product.quant_ids)">
                <div class="inventory-subgrid">
                    <!-- Stock Real -->
                    <div class="inventory-item item-stock">
                        <span class="inv-label">Físico</span>
                        <div class="inv-data">
                            <span class="inv-qty"><t t-esc="props.formatNumber(props.product.stock_qty)"/> m²</span>
                            <span class="inv-plates">(<t t-esc="props.product.stock_plates"/>)</span>
                        </div>
                    </div>

                    <!-- Apartado (Hold) -->
                    <div class="inventory-item item-hold" t-att-class="{ 'has-value': props.product.hold_qty > 0 }">
                        <span class="inv-label">Apartado</span>
                        <div class="inv-data">
                            <span class="inv-qty"><t t-esc="props.formatNumber(props.product.hold_qty)"/> m²</span>
                            <span class="inv-plates">(<t t-esc="props.product.hold_plates"/>)</span>
                        </div>
                    </div>

                    <!-- Reservado (Committed) -->
                    <div class="inventory-item item-committed" t-att-class="{ 'has-value': props.product.committed_qty > 0 }">
                        <span class="inv-label">Reservado</span>
                        <div class="inv-data">
                            <span class="inv-qty"><t t-esc="props.formatNumber(props.product.committed_qty)"/> m²</span>
                            <span class="inv-plates">(<t t-esc="props.product.committed_plates"/>)</span>
                        </div>
                    </div>

                    <!-- Disponible -->
                    <div class="inventory-item item-available">
                        <span class="inv-label">Disponible</span>
                        <div class="inv-data">
                            <span class="inv-qty"><t t-esc="props.formatNumber(props.product.available_qty)"/> m²</span>
                            <span class="inv-plates">(<t t-esc="props.product.available_plates"/>)</span>
                        </div>
                    </div>
                </div>
            </td>
            
            <!-- Type -->
            <td class="col-type d-none d-md-table-cell">
                <span t-if="props.product.tipo" class="badge-type" t-esc="props.product.tipo"/>
                <span t-else="" class="text-muted">-</span>
            </td>
            
            <!-- Category -->
            <td class="col-category d-none d-md-table-cell">
                <span t-if="props.product.categ_name" t-esc="props.product.categ_name"/>
                <span t-else="" class="text-muted">-</span>
            </td>
            
            <!-- Actions (Chevron) -->
            <td class="col-actions">
                <button 
                    type="button" 
                    class="btn-expand-details"
                    t-on-click="() => props.onToggle(props.product.quant_ids)"
                >
                    <i class="fa fa-chevron-down" t-att-class="{ 'fa-chevron-up': props.isExpanded }"></i>
                </button>
            </td>
        </tr>
        
        <!-- Fila de detalles (Expandible) -->
        <tr class="o_inventory_details_row" t-if="props.isExpanded">
            <!-- Colspan ajustado para incluir la nueva columna del checkbox -->
            <td colspan="6" class="details-cell">
                <ProductDetails 
                    details="props.details"
                    onPhotoClick="props.onPhotoClick"
                    onNotesClick="props.onNotesClick"
                    onDetailsClick="props.onDetailsClick"
                    onSalesPersonClick="props.onSalesPersonClick"
                    onHoldClick="props.onHoldClick"
                    onSaleOrderClick="props.onSaleOrderClick"
                    formatNumber="props.formatNumber"
                    isInCart="props.isInCart"
                    toggleCartSelection="props.toggleCartSelection"
                    areAllCurrentProductSelected="props.areAllCurrentProductSelected"
                    selectAllCurrentProduct="props.selectAllCurrentProduct"
                    deselectAllCurrentProduct="props.deselectAllCurrentProduct"
                    hasSalesPermissions="props.hasSalesPermissions"
                    hasInventoryPermissions="props.hasInventoryPermissions"
                />
            </td>
        </tr>
    </t>
    
</templates>